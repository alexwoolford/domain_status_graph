# Domain Status Graph Schema Documentation

## Overview

The Domain Status Graph is a focused knowledge graph that models domains and their technology stacks. The graph is designed to enable technology adoption prediction and affinity analysis using Graph Data Science (GDS).

**Purpose**: Enable technology adoption prediction and technology affinity bundling for competitive intelligence and sales targeting.

**Data Source**: SQLite database (`data/domain_status.db`) containing domain status checks and technology detection results. The database is generated by [`domain_status`](https://github.com/alexwoolford/domain_status), a Rust-based tool for high-performance concurrent URL checking and technology fingerprinting.

**Graph Database**: Neo4j (database: `domain`)

---

## Graph Statistics

- **Total Nodes**: ~6,500
  - Domains: ~5,978
  - Technologies: ~566

- **Total Relationships**: ~40,000+
  - USES (Domain → Technology): ~37,343 (from bootstrap)
  - HAS_COMPETITOR (Company → Company): ~2,100+ (from 10-K filings)
  - LIKELY_TO_ADOPT (Domain → Technology): ~varies (from GDS)
  - CO_OCCURS_WITH (Technology → Technology): ~varies (from GDS)
  - SIMILAR_DESCRIPTION (Company → Company): ~varies (from embeddings)

---

## Node Types

### Domain

**Label**: `Domain`

**Description**: Represents a web domain (e.g., `apple.com`, `microsoft.com`). This is the central entity in the graph.

**Unique Identifier**: `final_domain` (normalized domain name, lowercase, no `www.`)

**Schema Migration Note**: The graph uses semantic property names that map from the SQLite schema:
- `domain` maps from `initial_domain` in SQLite (the original domain from input URL)
- `status` maps from `http_status` in SQLite (HTTP status code)
- These names are kept for backward compatibility and semantic clarity

**Properties**:

| Property | Type | Required | Description | Example Values |
|----------|------|----------|-------------|----------------|
| `final_domain` | STRING | ✅ | Normalized domain name (unique key) | `apple.com`, `microsoft.com` |
| `domain` | STRING | ❌ | Original domain from input URL (maps from SQLite `initial_domain`) | `www.apple.com`, `apple.com` |
| `status` | INTEGER | ❌ | HTTP status code (maps from SQLite `http_status`) | `200`, `307` |
| `status_description` | STRING | ❌ | Human-readable status description | `OK`, `Temporary Redirect` |
| `response_time` | FLOAT | ❌ | HTTP response time in seconds | `0.226` - `31.722` |
| `timestamp` | INTEGER | ❌ | Unix timestamp of status check | `1735689600` |
| `is_mobile_friendly` | INTEGER | ❌ | Mobile-friendly flag (0/1) | `0`, `1` |
| `spf_record` | STRING | ❌ | SPF (Sender Policy Framework) record | `v=spf1 include:_spf.google.com ~all` |
| `dmarc_record` | STRING | ❌ | DMARC (Domain-based Message Authentication) record | `v=DMARC1; p=quarantine` |
| `title` | STRING | ❌ | HTML page title | `Apple - Official Site` |
| `keywords` | STRING | ❌ | Meta keywords tag | `apple, iphone, macbook` |
| `description` | STRING | ❌ | Meta description tag | `Shop the latest Apple products...` |
| `creation_date` | INTEGER | ❌ | Domain registration date (Unix timestamp) | `1735689600` |
| `expiration_date` | INTEGER | ❌ | Domain expiration date (Unix timestamp) | `1767225600` |
| `registrar` | STRING | ❌ | Domain registrar name | `GoDaddy`, `Namecheap` |
| `registrant_country` | STRING | ❌ | Country of domain registrant | `US`, `GB` |
| `registrant_org` | STRING | ❌ | Organization name of registrant | `Apple Inc.` |
| `loaded_at` | DATETIME | ✅ | Timestamp when node was loaded into graph | `2024-01-15T10:30:00Z` |

**Relationships**:
- `(Domain)-[:USES]->(Technology)` - Technologies used by the domain (from bootstrap)
- `(Domain)-[:LIKELY_TO_ADOPT {score}]->(Technology)` - Technology adoption predictions (from GDS)

**Use Cases**:
- Find all domains using a specific technology
- Compare technology stacks across companies
- Predict what technologies a domain is likely to adopt next
- Segment domains by technology sophistication
- Find domains with similar content (via title/keywords/description)
- Enable domain-level text similarity for company comparison

---

### Technology

**Label**: `Technology`

**Description**: Represents a technology, framework, library, or service detected on a domain (e.g., `WordPress`, `jQuery`, `Cloudflare`).

**Unique Identifier**: `name`

**Properties**:

| Property | Type | Required | Description | Example Values |
|----------|------|----------|-------------|----------------|
| `name` | STRING | ✅ | Technology name (unique key) | `WordPress`, `jQuery`, `Cloudflare` |
| `category` | STRING | ❌ | Technology category | `CMS`, `JavaScript libraries`, `CDN` |
| `loaded_at` | DATETIME | ✅ | Timestamp when node was loaded | `2024-01-15T10:30:00Z` |

**Technology Categories** (examples):
- Analytics: Google Analytics, Adobe Analytics
- CMS: WordPress, Drupal
- JavaScript libraries: jQuery, React, Vue.js
- CDN: Cloudflare, Akamai, Fastly
- And 60+ more categories

**Relationships**:
- `(Domain)-[:USES]->(Technology)` - Domains using this technology (from bootstrap)
- `(Technology)-[:CO_OCCURS_WITH {similarity}]->(Technology)` - Technology affinity pairs (from GDS)

**Use Cases**:
- Find all domains using a specific technology
- Find technologies that commonly co-occur (affinity bundling)
- Analyze technology adoption trends

---

## Relationship Types

### USES

**Type**: `(Domain)-[:USES]->(Technology)`

**Description**: Indicates that a domain uses a specific technology.

**Properties**:
- `loaded_at` (DATETIME) - When the relationship was created

**Example**:
```cypher
MATCH (d:Domain {final_domain: 'apple.com'})-[:USES]->(t:Technology)
RETURN t.name, t.category
ORDER BY t.category, t.name
```

---

### LIKELY_TO_ADOPT

**Type**: `(Domain)-[:LIKELY_TO_ADOPT {score}]->(Technology)`

**Description**: GDS-computed prediction of technologies a domain is likely to adopt next, based on Personalized PageRank on the Technology-Technology co-occurrence graph.

**Properties**:
- `score` (FLOAT) - Adoption prediction score (higher = more likely)
- `computed_at` (DATETIME) - When the prediction was computed

**Example**:
```cypher
MATCH (d:Domain {final_domain: 'example.com'})-[r:LIKELY_TO_ADOPT]->(t:Technology)
RETURN t.name, r.score
ORDER BY r.score DESC
LIMIT 5
```

**Use Case**: Sales targeting, competitive intelligence, roadmap planning

---

### CO_OCCURS_WITH

**Type**: `(Technology)-[:CO_OCCURS_WITH {similarity}]->(Technology)`

**Description**: GDS-computed similarity between technologies based on Jaccard similarity of their co-occurrence patterns.

**Properties**:
- `similarity` (FLOAT) - Jaccard similarity score (0-1, higher = more similar)
- `metric` (STRING) - Similarity metric used (`JACCARD`)
- `computed_at` (DATETIME) - When the relationship was computed

**Example**:
```cypher
MATCH (t1:Technology {name: 'WordPress'})-[r:CO_OCCURS_WITH]->(t2:Technology)
RETURN t2.name, r.similarity
ORDER BY r.similarity DESC
LIMIT 10
```

**Use Case**: Partnership opportunities, integration targeting, bundling strategies

---

### SIMILAR_DESCRIPTION

**Type**: `(Company)-[:SIMILAR_DESCRIPTION {score}]->(Company)`

**Description**: Cosine similarity between company descriptions based on embedding vectors. Computed using numpy (not GDS).

**Properties**:
- `score` (FLOAT) - Cosine similarity score (0-1, higher = more similar)
- `metric` (STRING) - Similarity metric used (`COSINE`)
- `computed_at` (DATETIME) - When the relationship was computed

**Example**:
```cypher
MATCH (c1:Company {ticker: 'AAPL'})-[r:SIMILAR_DESCRIPTION]->(c2:Company)
RETURN c2.name, c2.ticker, r.score
ORDER BY r.score DESC
LIMIT 10
```

**Use Case**: Competitive analysis, market segmentation, partnership opportunities

---

### HAS_COMPETITOR

**Type**: `(Company)-[:HAS_COMPETITOR {confidence, raw_mention}]->(Company)`

**Description**: Indicates that a company cited another company as a competitor in their 10-K filing. This is a **directional relationship** - it means "Company A explicitly mentioned Company B as a competitor in their SEC 10-K filing". The reverse relationship may not exist.

**Data Source**: Extracted from Item 1 (Business) and Item 1A (Risk Factors) sections of 10-K filings using NLP-based entity resolution.

**Properties**:
- `confidence` (FLOAT) - Entity resolution confidence (0-1, higher = more confident match)
- `raw_mention` (STRING) - How the competitor was mentioned in the 10-K (e.g., "Intel", "NVIDIA Corporation")
- `source` (STRING) - Always "ten_k_filing"
- `extracted_at` (DATETIME) - When the relationship was extracted

**Example**:
```cypher
// Find who NVIDIA cites as competitors
MATCH (c:Company {ticker:'NVDA'})-[r:HAS_COMPETITOR]->(comp:Company)
RETURN comp.ticker, comp.name, r.confidence, r.raw_mention
ORDER BY r.confidence DESC

// Find who cites Intel as a competitor
MATCH (c:Company)-[r:HAS_COMPETITOR]->(comp:Company {ticker:'INTC'})
RETURN c.ticker, c.name, r.raw_mention
ORDER BY c.name

// Find mutual competitors (both cite each other)
MATCH (a:Company)-[:HAS_COMPETITOR]->(b:Company)-[:HAS_COMPETITOR]->(a)
WHERE a.ticker < b.ticker
RETURN a.ticker, a.name, b.ticker, b.name
```

**Use Cases**:
- Map competitive landscapes by industry
- Find mutual competitors (bidirectional citations)
- Identify companies that cite many competitors (transparent about competition)
- Find the most-cited competitors (market leaders / targets)
- Validate company similarity using explicit competitor declarations

**Statistics**:
- Total relationships: ~2,100+
- Companies citing competitors: ~480
- Companies cited as competitors: ~700+
- Mutual competitor pairs: ~20+

---

## Constraints and Indexes

### Constraints

```cypher
CREATE CONSTRAINT domain_name IF NOT EXISTS FOR (d:Domain) REQUIRE d.final_domain IS UNIQUE;
CREATE CONSTRAINT technology_name IF NOT EXISTS FOR (t:Technology) REQUIRE t.name IS UNIQUE;
CREATE CONSTRAINT company_cik IF NOT EXISTS FOR (c:Company) REQUIRE c.cik IS UNIQUE;
```

### Indexes

```cypher
CREATE INDEX domain_domain IF NOT EXISTS FOR (d:Domain) ON (d.domain);
CREATE INDEX company_ticker IF NOT EXISTS FOR (c:Company) ON (c.ticker);
CREATE INDEX company_sector IF NOT EXISTS FOR (c:Company) ON (c.sector);
CREATE INDEX has_competitor_confidence IF NOT EXISTS FOR ()-[r:HAS_COMPETITOR]->() ON (r.confidence);
```

---

## Example Queries

### Find all domains using a specific technology
```cypher
MATCH (d:Domain)-[:USES]->(t:Technology {name: 'Shopify'})
RETURN d.final_domain, d.status
ORDER BY d.final_domain
```

### Get technology stack for a domain
```cypher
MATCH (d:Domain {final_domain: 'example.com'})-[:USES]->(t:Technology)
RETURN t.name, t.category
ORDER BY t.category, t.name
```

### Technology adoption predictions
```cypher
MATCH (d:Domain {final_domain: 'example.com'})-[r:LIKELY_TO_ADOPT]->(t:Technology)
RETURN t.name, r.score
ORDER BY r.score DESC
LIMIT 5
```

### Technology affinity pairs
```cypher
MATCH (t1:Technology {name: 'WordPress'})-[r:CO_OCCURS_WITH]->(t2:Technology)
RETURN t2.name, r.similarity
ORDER BY r.similarity DESC
LIMIT 10
```

---

## Data Loading

The graph is loaded from `data/domain_status.db` using `scripts/bootstrap_graph.py`:

1. **Domain nodes** - Loaded from `url_status` table
2. **Technology nodes** - Loaded from `url_technologies` table
3. **USES relationships** - Created from domain-technology mappings

GDS features are computed using `scripts/compute_gds_features.py`:

1. **LIKELY_TO_ADOPT relationships** - Computed using Personalized PageRank
2. **CO_OCCURS_WITH relationships** - Computed using Node Similarity (Jaccard)
3. **SIMILAR_DESCRIPTION relationships** - Computed using cosine similarity on embeddings

---

## Related Documentation

- **High-Value Queries**: `docs/money_queries.md` - 2 GDS features with business value
- **GDS Features**: `docs/gds_features.md` - Detailed feature documentation
- **Business Queries**: `docs/money_queries.md` - High-value business queries
